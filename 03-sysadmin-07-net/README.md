# Практическое задание по теме «Компьютерные сети 2»

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?
```bash
pavel@ubuntu:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:92:4c:dd brd ff:ff:ff:ff:ff:ff
    altname enp2s1
    inet 192.168.6.128/24 brd 192.168.6.255 scope global dynamic noprefixroute ens33
       valid_lft 1495sec preferred_lft 1495sec
    inet6 fe80::f42b:dd82:3643:3f18/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
```
в Windows можно использовать команду `ipconfig /all`
---
2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого? 

Для распознавания соседа используется протокол Link Layer Discovery Protocol (LLDP). В Linux есть пакет `lldpd`.
Поднял дополнительную машину на CentOS 7, произвел установку пакета lldpd.
```bash
Ubuntu
sudo apt-get upgrade
sudo apt-get install lldpd
sudo systemctl enable lldpd && systemctl start lldpd
```
```bash
CentOS 7
yum install epel-release
yum install lldpd
systemctl --now enable lldpd
```
```bash
на Ubuntu `lldpctl`
Interface:    ens33, via: LLDP, RID: 2, Time: 0 day, 00:00:33
  Chassis:     
    ChassisID:    mac 00:0c:29:a3:c8:b5
    SysName:      centos7-1.local
    SysDescr:     CentOS Linux 7 (Core) Linux 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64
    MgmtIP:       192.168.6.129
    MgmtIP:       fe80::c37c:524c:6145:7023
    Capability:   Bridge, off
    Capability:   Router, off
    Capability:   Wlan, off
    Capability:   Station, on
  Port:        
    PortID:       mac 00:0c:29:a3:c8:b5
    PortDescr:    ens33
    TTL:          120
    PMD autoneg:  supported: yes, enabled: yes
      Adv:          10Base-T, HD: yes, FD: yes
      Adv:          100Base-TX, HD: yes, FD: yes
      Adv:          1000Base-T, HD: no, FD: yes
      MAU oper type: 1000BaseTFD - Four-pair Category 5 UTP, full duplex mode

```
---
3. Какая технология используется для разделения L2-коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.
Технология VLAN (Virtual Local Area Network). В Linux пакет `vlan`. 
Пример :

```bash
iface vlan1 inet static
  vlan-raw-device eth0
  address 192.168.1.1
  netmask 255.255.255.0
```
`vlan-raw-device` — указывает на каком сетевом интерфейсе должен создаваться новый интерфейс `vlan1`.
```bash
ip link add link eth0 name eth0.10 type vlan id 10
ip -d link show eth0.10
ip addr add 192.168.1.200/24 brd 192.168.1.255 dev eth0.10
ip link set dev eth0.10 up
```
```bash
sudo nano /etc/network/interfaces
#vlan с ID-100 для интерфейса eth0 with ID - 100 в Debian/Ubuntu Linux
auto eth0.100
iface eth0.100 inet static
address 192.168.1.200
netmask 255.255.255.0
vlan-raw-device eth0
```
---
4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

Типы агрегации интерфейсов в Linux:

* `mode=0 (balance-rr)` — обеспечивает балансировку нагрузки и отказоустойчивость. В данном режиме пакеты отправляются "по кругу" от первого интерфейса к последнему и сначала. Если выходит из строя один из интерфейсов, пакеты отправляются на остальные оставшиеся. При подключении портов к разным коммутаторам, требует их настройки.
* `mode=1 (active-backup)` — при active-backup один интерфейс работает в активном режиме, остальные в ожидающем. Если активный падает, управление передается одному из ожидающих. Не требует поддержки данной функциональности от коммутатора.
* `mode=2 (balance-xor)` — передача пакетов распределяется между объединенными интерфейсами по формуле ((MAC-адрес источника) XOR (MAC-адрес получателя)) % число интерфейсов. Один и тот же интерфейс работает с определённым получателем. Режим даёт балансировку нагрузки и отказоустойчивость.
* `mode=3 (broadcast)` — происходит передача во все объединенные интерфейсы, обеспечивая отказоустойчивость.
* `mode=4 (802.3ad)` — это динамическое объединение портов. В данном режиме можно получить значительное увеличение пропускной способности как входящего так и исходящего трафика, используя все объединенные интерфейсы. Требует поддержки режима от коммутатора, а так же (иногда) дополнительную настройку коммутатора.
* `mode=5 (balance-tlb)` — адаптивная балансировка нагрузки. При balance-tlb входящий трафик получается только активным интерфейсом, исходящий - распределяется в зависимости от текущей загрузки каждого интерфейса. Обеспечивается отказоустойчивость и распределение нагрузки исходящего трафика. Не требует специальной поддержки коммутатора.
* `mode=6 (balance-alb)` — адаптивная балансировка нагрузки, обеспечивает балансировку нагрузки как исходящего (TLB, transmit load balancing), так и входящего трафика (для IPv4 через ARP). Не требует специальной поддержки коммутатором, но требует возможности изменять MAC-адрес устройства.

Пример из сети:

```bash
iface bond0 inet static
        address 10.0.0.11
        netmask 255.255.255.0
        gateway 10.0.0.254
        bond-slaves eth0 eth1
        bond-mode balance-alb # адаптивная балансировка нагрузки
bond-miimon 100
bond-downdelay 200
```
---
5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

Для выполнения задачи можно воспользоваться калькулятором подсетей онлайн или пакетом ipcalc. Установим пакет `sudo apt-get install ipcalc` и выполним команду:
```bash
ipcalc 192.168.1.1/29
Address:   192.168.1.1          11000000.10101000.00000001.00000 001
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   192.168.1.0/29       11000000.10101000.00000001.00000 000
HostMin:   192.168.1.1          11000000.10101000.00000001.00000 001
HostMax:   192.168.1.6          11000000.10101000.00000001.00000 110
Broadcast: 192.168.1.7          11000000.10101000.00000001.00000 111
Hosts/Net: 6                     Class C, Private Internet 
```
В результате видимо, что: 
* Битовая маска: /29 
* Сетевая маска: 255.255.255.248
* Адрес сети: 192.168.1.1
* Первый хост: 192.168.1.1
* Последний хост: 192.168.1.6
* Широковещательный адрес: 192.168.1.7 
* Всего хостов: 6
```bash
ipcalc 10.10.10.0/24

Address:   10.10.10.0           00001010.00001010.00001010. 00000000
Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
=>
Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
Hosts/Net: 254                   Class A, Private Internet
```

Из сети с маской /24 можно получить 32 /29 подсети. 

Примеры /29 подсетей:
* 10.10.10.0/29 
* 10.10.10.8/29 
* 10.10.10.16/29
---

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

Это частные подсети. Необходимо использовать свободную: 100.64.0.0 — 100.127.255.255 (маска /10). 

Используем сеть 100.64.0.0/26 (на 62 хоста).

```bash
ipcalc 100.64.0.0/26

Address:   100.64.0.0           01100100.01000000.00000000.00 000000
Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
=>
Network:   100.64.0.0/26        01100100.01000000.00000000.00 000000
HostMin:   100.64.0.1           01100100.01000000.00000000.00 000001
HostMax:   100.64.0.62          01100100.01000000.00000000.00 111110
Broadcast: 100.64.0.63          01100100.01000000.00000000.00 111111
Hosts/Net: 62                    Class A
```

---
7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

Для Linux: `sudo apt-get install net-tools`. Затем:

* Проверить ARP-таблицу: `arp -n`
* Очистить кеш: `ip neigh flush`
* Удалить один IP: `arp -d <address>`

В Windows проверить APR-таблицу можно командой `arp -a`.

